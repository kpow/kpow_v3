# Digital Ocean App Platform Migration Plan

## Overview
This document outlines the complete migration plan for the Book Metadata Enrichment Platform from Replit to Digital Ocean App Platform.

## Application Architecture
- **Frontend**: React with TypeScript, Vite build system
- **Backend**: Express.js with TypeScript
- **Database**: PostgreSQL with Drizzle ORM
- **Key Features**: Book/author metadata enrichment, Goodreads integration, image processing

## Pre-Migration Requirements

### 1. Digital Ocean Account Setup
- [ ] Create Digital Ocean account
- [ ] Verify billing information
- [ ] Install `doctl` CLI tool (optional but recommended)

### 2. Source Code Repository
- [ ] Push code to GitHub repository
- [ ] Ensure repository is public or grant Digital Ocean access
- [ ] Set main branch as default deployment branch

### 3. Environment Variables & Secrets
Collect all required API keys and configuration values:

#### Required Environment Variables
- `DATABASE_URL` - Will be auto-generated by Digital Ocean PostgreSQL
- `SESSION_SECRET` - Generate a secure random string
- `NODE_ENV` - Set to "production"
- `PORT` - Set to "8080" (Digital Ocean standard)

#### Optional API Keys (based on your application features)
- `OPENAI_API_KEY` - For AI features
- `GOODREADS_API_KEY` - For book metadata enrichment
- `GOOGLE_API_KEY` - For Google services integration
- `LASTFM_API_KEY` - For music-related features
- `YOUTUBE_API_KEY` - For YouTube integration
- `INSTAGRAM_ACCESS_TOKEN` - For Instagram integration
- Email configuration (if using nodemailer):
  - `SMTP_HOST`
  - `SMTP_PORT`
  - `SMTP_USER`
  - `SMTP_PASS`

## Migration Steps

### Step 1: Prepare Application for Production

#### 1.1 Update Package.json Scripts
The application already has proper build and start scripts:
```json
{
  "scripts": {
    "build": "vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist",
    "start": "NODE_ENV=production node dist/index.js"
  }
}
```

#### 1.2 Configuration Files
The following files have been created for you:
- `.env.example` - Template for environment variables
- `.do/app.yaml` - Digital Ocean App Platform configuration

### Step 2: Database Migration Preparation

#### 2.1 Export Current Database Schema
```bash
# Run this command to generate migration files
npm run db:push
```

#### 2.2 Export Data (if needed)
```bash
# Export your current database data
pg_dump $DATABASE_URL > database_backup.sql
```

### Step 3: Digital Ocean Deployment

#### 3.1 Create App via Digital Ocean Control Panel
1. Go to [Digital Ocean Apps](https://cloud.digitalocean.com/apps)
2. Click "Create App"
3. Choose "GitHub" as source
4. Select your repository and branch
5. Digital Ocean will auto-detect it as a Node.js app

#### 3.2 Configure App Settings
1. **Service Configuration**:
   - Service Type: Web Service
   - Instance Size: Basic ($5/month recommended for start)
   - Instance Count: 1
   - HTTP Port: 8080

2. **Environment Variables**:
   Set all required environment variables from your `.env.example` file

3. **Database Configuration**:
   - Add PostgreSQL database component
   - Size: Basic ($15/month for development)
   - Version: 14 or 16

#### 3.3 Deploy Application
1. Review configuration
2. Click "Create Resources"
3. Wait for deployment (typically 5-10 minutes)

### Step 4: Post-Deployment Configuration

#### 4.1 Database Setup
```bash
# Connect to your new database and run migrations
npm run db:push
```

#### 4.2 Import Data (if migrating existing data)
```bash
# Import your data to the new database
psql $DATABASE_URL < database_backup.sql
```

#### 4.3 Verify Deployment
- [ ] Check health endpoint: `https://your-app.ondigitalocean.app/api/health`
- [ ] Test main application functionality
- [ ] Verify database connections
- [ ] Test API endpoints

### Step 5: DNS and Domain Configuration (Optional)

#### 5.1 Custom Domain Setup
1. Go to your app settings in Digital Ocean
2. Add custom domain
3. Configure DNS records with your domain provider:
   - CNAME record pointing to your Digital Ocean app URL

#### 5.2 SSL Certificate
- Digital Ocean automatically provisions SSL certificates
- No additional configuration needed

## Cost Estimates

### Digital Ocean App Platform Pricing
- **Basic Web Service**: $5/month
- **PostgreSQL Database (Basic)**: $15/month
- **Total Monthly Cost**: ~$20/month

### Comparison with Replit
- More predictable pricing
- Better performance for production workloads
- Professional deployment environment

## Monitoring and Maintenance

### 5.1 Application Monitoring
- Digital Ocean provides built-in metrics
- Monitor CPU, memory, and request metrics
- Set up alerts for deployment failures

### 5.2 Database Monitoring
- Monitor database performance
- Set up automated backups
- Monitor storage usage

### 5.3 Logs and Debugging
- Access application logs via Digital Ocean dashboard
- Use `doctl` CLI for advanced log management
- Set up log forwarding if needed

## Rollback Plan

### If Migration Fails
1. Keep Replit deployment running during migration
2. Test Digital Ocean deployment thoroughly
3. Update DNS only after full verification
4. Keep database backups for quick restoration

### Emergency Rollback
1. Revert DNS changes (if using custom domain)
2. Restore from database backup if needed
3. Redeploy to Replit if necessary

## Security Considerations

### 5.1 Environment Variables
- All secrets stored securely in Digital Ocean
- No secrets in code repository
- Regular rotation of API keys

### 5.2 Database Security
- Database accessible only from your app
- Encrypted connections
- Regular security updates

### 5.3 Application Security
- HTTPS enforced by default
- Regular dependency updates
- Security headers configured

## Performance Optimizations

### 5.1 Application Level
- Vite build optimization already configured
- Static file serving optimized
- Express.js performance middleware

### 5.2 Database Level
- Connection pooling configured
- Proper indexing on frequently queried fields
- Query optimization with Drizzle ORM

## Migration Checklist

### Pre-Migration
- [ ] Code pushed to GitHub
- [ ] Environment variables documented
- [ ] Database backup created
- [ ] Digital Ocean account set up

### During Migration
- [ ] App created in Digital Ocean
- [ ] Database provisioned
- [ ] Environment variables configured
- [ ] Initial deployment successful

### Post-Migration
- [ ] Health check endpoint responding
- [ ] Database migrations applied
- [ ] Data imported (if applicable)
- [ ] All API endpoints tested
- [ ] Performance validated
- [ ] Monitoring configured

### Final Steps
- [ ] DNS updated (if using custom domain)
- [ ] SSL certificate verified
- [ ] Documentation updated
- [ ] Team notified of new URLs

## Support and Resources

### Digital Ocean Documentation
- [App Platform Documentation](https://docs.digitalocean.com/products/app-platform/)
- [Database Documentation](https://docs.digitalocean.com/products/databases/)
- [CLI Tool (doctl)](https://docs.digitalocean.com/reference/doctl/)

### Application-Specific Resources
- Drizzle ORM documentation for database operations
- Express.js production best practices
- React deployment optimization guides

## Emergency Contacts
- Digital Ocean Support: Available 24/7 via ticket system
- Database issues: Check Digital Ocean status page first
- Application issues: Review application logs in dashboard

---

**Note**: This migration plan assumes you have administrative access to all required services and API keys. Ensure all team members have necessary permissions before beginning the migration process.